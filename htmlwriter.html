<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>HTML Modernizer Pro</title>
<style>
body { font-family: sans-serif; padding:20px; background:#f2f2f2;}
textarea { width:100%; height:200px; margin:10px 0;}
button { padding:10px 20px; margin:10px 0;}
.panel { background:white; padding:15px; margin-bottom:15px; border-radius:5px;}
#log { background:#111; color:#0f0; padding:10px; height:150px; overflow:auto;}
label { display:block; }
</style>
</head>
<body>

<h2>HTML Modernizer Pro</h2>

<div class="panel">
<textarea id="input" placeholder="古いHTMLを入力"></textarea>
</div>

<div class="panel">
<label><input type="checkbox" id="font" checked> font → span</label>
<label><input type="checkbox" id="center" checked> center → div</label>
<label><input type="checkbox" id="bi" checked> b/i → strong/em</label>
<label><input type="checkbox" id="bgcolor" checked> bgcolor → style</label>
<label><input type="checkbox" id="viewport" checked> viewport追加</label>
</div>

<button onclick="convert()">変換する</button>

<div class="panel">
<textarea id="output" placeholder="変換結果"></textarea>
<button onclick="download()">ダウンロード</button>
</div>

<div class="panel">
<h3>変換ログ</h3>
<div id="log"></div>
</div>

<script>
function log(message){
    document.getElementById("log").innerHTML += message + "<br>";
}

function convert(){
    document.getElementById("log").innerHTML = "";
    const input = document.getElementById("input").value;
    const parser = new DOMParser();
    const doc = parser.parseFromString(input, "text/html");

    let count;

    if(document.getElementById("font").checked){
        count = 0;
        doc.querySelectorAll("font").forEach(el=>{
            const span = doc.createElement("span");
            span.innerHTML = el.innerHTML;
            if(el.color) span.style.color = el.color;
            if(el.size) span.style.fontSize = el.size + "px";
            el.replaceWith(span);
            count++;
        });
        log("font → span : " + count + "件");
    }

    if(document.getElementById("center").checked){
        count = 0;
        doc.querySelectorAll("center").forEach(el=>{
            const div = doc.createElement("div");
            div.style.textAlign = "center";
            div.innerHTML = el.innerHTML;
            el.replaceWith(div);
            count++;
        });
        log("center → div : " + count + "件");
    }

    if(document.getElementById("bi").checked){
        count = 0;
        doc.querySelectorAll("b").forEach(el=>{
            const strong = doc.createElement("strong");
            strong.innerHTML = el.innerHTML;
            el.replaceWith(strong);
            count++;
        });
        doc.querySelectorAll("i").forEach(el=>{
            const em = doc.createElement("em");
            em.innerHTML = el.innerHTML;
            el.replaceWith(em);
            count++;
        });
        log("b/i変換 : " + count + "件");
    }

    if(document.getElementById("bgcolor").checked){
        count = 0;
        doc.querySelectorAll("[bgcolor]").forEach(el=>{
            el.style.backgroundColor = el.getAttribute("bgcolor");
            el.removeAttribute("bgcolor");
            count++;
        });
        log("bgcolor削除 : " + count + "件");
    }

    if(document.getElementById("viewport").checked){
        if(!doc.querySelector("meta[name=viewport]")){
            const meta = doc.createElement("meta");
            meta.name = "viewport";
            meta.content = "width=device-width, initial-scale=1.0";
            doc.head.appendChild(meta);
            log("viewport追加");
        }
    }

    if(doc.querySelectorAll("table").length > 0){
        log("⚠ tableタグ検出（レイアウト用途の可能性あり）");
    }

    document.getElementById("output").value =
        "<!DOCTYPE html>\n" + doc.documentElement.outerHTML;
}

function download(){
    const content = document.getElementById("output").value;
    const blob = new Blob([content], {type:"text/html"});
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "modernized.html";
    a.click();
}
</script>

</body>
</html>
